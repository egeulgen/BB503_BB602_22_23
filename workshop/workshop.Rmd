---
title: "MESEK Wokshop"
author: "Ege Ulgen"
date: '2022-12-16'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Why R?

Very commonly is used in data science

-   Free & open-source
-   Vector operations
-   Great community
-   10k+ packages

# Installing R + RStudio

Demo

# Basics

## Working Directory

```{r}
getwd()
?getwd()

?setwd()
setwd("~/Dropbox/Teaching/MESEK_egitim/")
```

## Basic Operations

```{r}
2 + 3
2 * 3
2 ^ 3
```

```{r}
x <- 2
y <- 3

x + y

2*x - 10 * y

z <- x + y - 2 * x * y
z
```

```{r}
str1 <- "Hello"
str2 <- "World"

paste(str1, str2)
```

## Overview of RStudio Panels

Demo

## Vectors

```{r}
# store a vector
height <- c(168, 177, 177, 177, 178, 172, 165, 171, 178, 170)
height

# print the second element
height[2]

# print from the 2nd to the 5th element
height[2:5]

# Define a vector as a sequence (1 to 10)
obs <- 1:10

# Perform a simple calculation using vectors (element-wise)
weight <- c(88, 72, 85, 52, 71, 69, 61, 61, 51, 75)

BMI <- weight / ((height / 100) ^ 2)
BMI
```

```{r}
### appending to and deleting from a vector
# empty vector
my_vec <- c()
# append to vector
my_vec <- c(my_vec, 3)
my_vec
my_vec <- c(1, 2, my_vec)
my_vec

# delete an element
my_vec[2]
my_vec <- my_vec[-2]
my_vec
```

```{r}
### simple descriptions of the vector
# length
length(height)

# sample mean
mean(height)
?mean

# sample variance/standard deviation
(s2 <- var(height))
sqrt(s2)

sd(height)

# median, range
median(height)

range(height)

# quantiles
#Q1
quantile(height, probs = 0.25)

#Q3
quantile(height, 0.75)


# 33rd and 66th percentiles
quantile(height, c(0.33, 0.66))

# summary
summary(height)

# correlation
cor(height, weight)
cor(height, weight, method = "spearman")

cor.test(height, weight)
```

```{r}
### string vectors
eye_color <- c("blue", "green", "brown", "blue", "brown", 
               "blue", "blue", "green", "brown", "brown")

table(eye_color)
```

## Matrices

```{r}
# create an all-zero matrix of 3 x 5
M0 <- matrix(0, nrow = 3, ncol = 5)
M0

# create aa matrix combining the previous variables rowwise
M <- rbind(obs, height, weight, BMI)
M

# create aa matrix combining the previous variables columnwise
M <- cbind(obs, height, weight, BMI)
M

class(M)

dim(M)
```

## Data frames

```{r}
df <- data.frame(observation = obs,
                 height = height,
                 weight = weight,
                 BMI = BMI,
                 Gender = as.factor(rep(c("M", "F"), each = 5)))

class(df)
colnames(df)

head(df)
head(df, 3)
tail(df, 2)

# descriptive statistics
summary(df)

df$BMI
boxplot(df$BMI)
```

# Demo: Robot-Assisted Minimally Invasive Distal Pancreatectomy Is Superior to the Laparoscopic Technique

This will be a demonstration using simulated data based on **Daouadi M, Zureikat AH, Zenati MS, Choudry H, Tsung A, Bartlett DL, et al. Robot-assisted minimally invasive distal pancreatectomy is superior to the laparoscopic technique. Ann Surg. 2013 Jan;257(1):128--32.**

## Read Data

Demonstrate via GUI. Alternatively:

```{r}
study_df <- read.csv("LA_vs_RA_data.csv")

head(study_df, 2)
```

Convert character columns (variables) into factors:

```{r}
study_df$gender <- as.factor(study_df$gender)
study_df$ethnicity <- as.factor(study_df$ethnicity)
study_df$ASA <- as.factor(study_df$ASA)
study_df$prev_abd_surgery <- as.factor(study_df$prev_abd_surgery)
study_df$conv2open <- as.factor(study_df$conv2open)
study_df$surgery_type <- as.factor(study_df$surgery_type)
```

Look at summaries:

```{r}
summary(study_df)
```

## Compare baseline characteristics

```{r}
boxplot(study_df$age~study_df$surgery_type)
boxplot(study_df$age~study_df$surgery_type,
        col = "blue", 
        xlab = "Surgery type", ylab = "Age")

hist(study_df$age)

t.test(study_df$age~study_df$surgery_type)
```

```{r}
table(study_df$gender)

table(study_df$gender, study_df$surgery_type)

barplot(table(study_df$gender, study_df$surgery_type))
barplot(table(study_df$gender, study_df$surgery_type), ylim = c(0, 100))

chisq.test(table(study_df$gender, study_df$surgery_type))
```

```{r}
tbl <- table(study_df$surgery_type, study_df$prev_abd_surgery)
tbl / rowSums(tbl)

barplot(t(tbl))
barplot(t(tbl / rowSums(tbl)))

chisq.test(tbl)
```

## Compare surgical end-points

```{r}
boxplot(study_df$procedure_duration~study_df$surgery_type)

hist(study_df$procedure_duration)

t.test(study_df$procedure_duration~study_df$surgery_type)
```

```{r}
table(study_df$conv2open)

tbl <- table(study_df$conv2open, study_df$surgery_type)
tbl

barplot(tbl, ylim = c(0, 100))

chisq.test(tbl)
fisher.test(tbl)
```
